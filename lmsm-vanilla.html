<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LMSM Emulator</title>
  <link rel="stylesheet" href="https://the.missing.style/v1.0.8/missing.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/codemirror.min.css" integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="lmsm.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/codemirror.min.js" integrity="sha512-rdFIN28+neM8H8zNsjRClhJb1fIYby2YCNmoqwnqBDEvZgpcp7MJiX8Wd+Oi6KcJOMOuvGztjrsI59rly9BsVQ==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/addon/mode/simple.min.js" integrity="sha512-CGM6DWPHs250F/m90YZ9NEiEUhd9a4+u8wAzeKC6uHzZbYyt9/e2dLC5BGGB6Y0HtEdZQdSDYjDsoTyNGdMrMA==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
  <script src="https://unpkg.com/hyperscript.org@0.9.7"></script>
  <script src="lmsm-vanilla.js"></script>
  <script src="lmsm-ui-vanilla.js" defer></script>
</head>

<body class="padding riobeachonsummer">
  <div class="grid">
    <div id="titleBox" class="box center" data-cols="1 3" data-rows="1">
      <h2 class="allcaps">Little Man Stack Machine Emulator</h2>
    </div>
    <div id="codeEditorBox" class="box" data-cols="1" data-rows="2 5">
      <strong class="allcaps block titlebar">IDE</strong>
      <label for="mode">
        <select name="mode" _="
          on load set @value to window.lmsm.mode
          on change call window.lmsm.setMode(my value)
        ">
          <option value="lmsm-assembly">Assembly</option>
          <option value="firth">Firth</option>
        </select>
      </label>
      <section class="tool-bar" x-data="{
      }">
        <label x-show="mode === 'firth'">
          <input type="button" _="on click call window.lmsm.compile()" value="Compile" />
        </label>
        <label x-show="mode === 'lmsm-assembly'">
          <input type="button" _="on click call window.lmsm.assemble()" value="Assemble" />
        </label>
        <label>
          <input type="button" _="on click call window.lmsm.run()" value="Run" />
        </label>
        <label x-show="mode === 'lmsm-assembly'">
          <input type="button" _="on click call window.lmsm.assembleAndRun()" value="Load & Run" />
        </label>
        <label x-show="mode === 'lmsm-assembly'">
          <input type="button" _="on click call window.lmsm.step()" value="Step" />
        </label>
      </section>
      <div id="codeEditor"></div>
    </div>
    <div id="registerFileBox" class="box" data-cols="2" data-rows="2">
      <strong class="allcaps block titlebar">Register File</strong>
      <div class="margin grid">
        <div class="box bad" data-cols="1">
          <label for="pc" class="bold">PC:
            <input name="pc" class="register" type="text" size="3" _="
              on load set @value to window.lmsm.getProgramCounter()
              on changepc set my value to the value of the event
            " />
          </label>
        </div>
        <div class="box info" data-cols="2">
          <label for="acc" class="bold">ACC:
            <input name="acc" class="register" size="3" type="text" _="
            on load set @value to window.lmsm.getAccumulator()
            on changeacc set my value to the value of the event
          " />
          </label>
        </div>
        <div class="box info" data-cols="3">
          <label for="ci" class="bold">CI:
            <input name="ci" class="register" size="3" type="text" _="
            on load set @value to window.lmsm.getCurrentInstruction()
            on changeci set my value to the value of the event
          " />
          </label>
        </div>
        <div class="box ok" data-cols="4">
          <label for="sp" class="bold">SP:
            <input name="sp" class="register" size="3" type="text" _="
            on load set @value to window.lmsm.getStackPointer()
            on changesp set my value to the value of the event
          " />
          </label>
        </div>
        <div class="box warn" data-cols="5">
          <label for="rap" class="bold">RAP:
            <input name="rap" class="register" size="3" type="text" _="
            on load set @value to window.lmsm.getReturnAddressPointer()
            on changerap set my value to the value of the event
          " />
          </label>
        </div>
      </div>
    </div>
    <div id="memoryBox" class="box" data-cols="2" data-rows="3 5">
      <strong class="allcaps block titlebar">Memory Layout</strong>
      <div class="center" _="
        on load put window.lmsm.memoryLayout() into me
      ">
      </div>
    </div>
    <div id="outputBox" class="box" data-cols="3" data-rows="2 5">
      <strong class="allcaps block titlebar">Output</strong>
      <input type="button" @click="lmsm.clearOutput()" value="Clear" />
      <div id="outputPane" class="box pane" 
        _="on mutation of childList me.scroll({top: my scrollHeight, left: 0, behavior: 'smooth'})">
        <template x-for="line in lmsm.output">
          <div x-text="line"></div>
        </template>
      </div>
    </div>
  </div>
</body>

</html>